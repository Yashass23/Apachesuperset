{"version":3,"file":"c800a320ff0516f83fb9.chunk.js","mappings":"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","sources":["webpack://superset/./src/explore/components/controls/AnnotationLayerControl/AnnotationTypes.js","webpack://superset/./src/explore/components/controls/AnnotationLayerControl/AnnotationLayer.jsx","webpack://superset/./packages/superset-ui-core/src/math-expression/index.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\n\nfunction extractTypes(metadata) {\n  return Object.keys(metadata).reduce((prev, key) => {\n    const result = prev;\n    result[key] = key;\n    return result;\n  }, {});\n}\n\nexport const ANNOTATION_TYPES_METADATA = {\n  FORMULA: {\n    value: 'FORMULA',\n    label: t('Formula'),\n  },\n  EVENT: {\n    value: 'EVENT',\n    label: t('Event'),\n    supportNativeSource: true,\n  },\n  INTERVAL: {\n    value: 'INTERVAL',\n    label: t('Interval'),\n    supportNativeSource: true,\n  },\n  TIME_SERIES: {\n    value: 'TIME_SERIES',\n    label: t('Time series'),\n  },\n};\n\nexport const ANNOTATION_TYPES = extractTypes(ANNOTATION_TYPES_METADATA);\n\nexport const DEFAULT_ANNOTATION_TYPE = ANNOTATION_TYPES.FORMULA;\n\nexport const ANNOTATION_SOURCE_TYPES_METADATA = {\n  NATIVE: {\n    value: 'NATIVE',\n    label: 'Superset annotation',\n  },\n};\n\nexport const ANNOTATION_SOURCE_TYPES = extractTypes(\n  ANNOTATION_SOURCE_TYPES_METADATA,\n);\n\nexport function requiresQuery(annotationSourceType) {\n  return !!annotationSourceType;\n}\n\nconst NATIVE_COLUMN_NAMES = {\n  timeColumn: 'start_dttm',\n  intervalEndColumn: 'end_dttm',\n  titleColumn: 'short_descr',\n  descriptionColumns: ['long_descr'],\n};\n\nexport function applyNativeColumns(annotation) {\n  if (annotation.sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n    return { ...annotation, ...NATIVE_COLUMN_NAMES };\n  }\n  return annotation;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport rison from 'rison';\nimport PropTypes from 'prop-types';\nimport { CompactPicker } from 'react-color';\nimport Button from 'src/components/Button';\nimport {\n  t,\n  SupersetClient,\n  getCategoricalSchemeRegistry,\n  getChartMetadataRegistry,\n  validateNonEmpty,\n  isValidExpression,\n  styled,\n  getColumnLabel,\n  withTheme,\n} from '@superset-ui/core';\nimport SelectControl from 'src/explore/components/controls/SelectControl';\nimport { AsyncSelect } from 'src/components';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport CheckboxControl from 'src/explore/components/controls/CheckboxControl';\nimport PopoverSection from 'src/components/PopoverSection';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { EmptyStateSmall } from 'src/components/EmptyState';\nimport {\n  ANNOTATION_SOURCE_TYPES,\n  ANNOTATION_TYPES,\n  ANNOTATION_TYPES_METADATA,\n  DEFAULT_ANNOTATION_TYPE,\n  requiresQuery,\n  ANNOTATION_SOURCE_TYPES_METADATA,\n} from './AnnotationTypes';\n\nconst AUTOMATIC_COLOR = '';\n\nconst propTypes = {\n  name: PropTypes.string,\n  annotationType: PropTypes.string,\n  sourceType: PropTypes.string,\n  color: PropTypes.string,\n  opacity: PropTypes.string,\n  style: PropTypes.string,\n  width: PropTypes.number,\n  showMarkers: PropTypes.bool,\n  hideLine: PropTypes.bool,\n  value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  overrides: PropTypes.object,\n  show: PropTypes.bool,\n  showLabel: PropTypes.bool,\n  titleColumn: PropTypes.string,\n  descriptionColumns: PropTypes.arrayOf(PropTypes.string),\n  timeColumn: PropTypes.string,\n  intervalEndColumn: PropTypes.string,\n  vizType: PropTypes.string,\n\n  error: PropTypes.string,\n  colorScheme: PropTypes.string,\n\n  addAnnotationLayer: PropTypes.func,\n  removeAnnotationLayer: PropTypes.func,\n  close: PropTypes.func,\n};\n\nconst defaultProps = {\n  name: '',\n  annotationType: DEFAULT_ANNOTATION_TYPE,\n  sourceType: '',\n  color: AUTOMATIC_COLOR,\n  opacity: '',\n  style: 'solid',\n  width: 1,\n  showMarkers: false,\n  hideLine: false,\n  overrides: {},\n  colorScheme: 'd3Category10',\n  show: true,\n  showLabel: false,\n  titleColumn: '',\n  descriptionColumns: [],\n  timeColumn: '',\n  intervalEndColumn: '',\n\n  addAnnotationLayer: () => {},\n  removeAnnotationLayer: () => {},\n  close: () => {},\n};\n\nconst NotFoundContentWrapper = styled.div`\n  && > div:first-child {\n    padding-left: 0;\n    padding-right: 0;\n  }\n`;\n\nconst NotFoundContent = () => (\n  <NotFoundContentWrapper>\n    <EmptyStateSmall\n      title={t('No annotation layers')}\n      description={\n        <span>\n          {t('Add an annotation layer')}{' '}\n          <a\n            href=\"/annotationlayer/list\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            {t('here')}\n          </a>\n          .\n        </span>\n      }\n      image=\"empty.svg\"\n    />\n  </NotFoundContentWrapper>\n);\n\nclass AnnotationLayer extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    const {\n      name,\n      annotationType,\n      sourceType,\n      color,\n      opacity,\n      style,\n      width,\n      showMarkers,\n      hideLine,\n      value,\n      overrides,\n      show,\n      showLabel,\n      titleColumn,\n      descriptionColumns,\n      timeColumn,\n      intervalEndColumn,\n      vizType,\n    } = props;\n\n    // Only allow override whole time_range\n    if ('since' in overrides || 'until' in overrides) {\n      overrides.time_range = null;\n      delete overrides.since;\n      delete overrides.until;\n    }\n\n    // Check if annotationType is supported by this chart\n    const metadata = getChartMetadataRegistry().get(vizType);\n    const supportedAnnotationTypes = metadata?.supportedAnnotationTypes || [];\n    const validAnnotationType = supportedAnnotationTypes.includes(\n      annotationType,\n    )\n      ? annotationType\n      : supportedAnnotationTypes[0];\n\n    this.state = {\n      // base\n      name,\n      annotationType: validAnnotationType,\n      sourceType,\n      value,\n      overrides,\n      show,\n      showLabel,\n      // slice\n      titleColumn,\n      descriptionColumns,\n      timeColumn,\n      intervalEndColumn,\n      // display\n      color: color || AUTOMATIC_COLOR,\n      opacity,\n      style,\n      width,\n      showMarkers,\n      hideLine,\n      // refData\n      isNew: !name,\n      slice: null,\n    };\n    this.submitAnnotation = this.submitAnnotation.bind(this);\n    this.deleteAnnotation = this.deleteAnnotation.bind(this);\n    this.applyAnnotation = this.applyAnnotation.bind(this);\n    this.isValidForm = this.isValidForm.bind(this);\n    // Handlers\n    this.handleAnnotationType = this.handleAnnotationType.bind(this);\n    this.handleAnnotationSourceType =\n      this.handleAnnotationSourceType.bind(this);\n    this.handleSelectValue = this.handleSelectValue.bind(this);\n    this.handleTextValue = this.handleTextValue.bind(this);\n    // Fetch related functions\n    this.fetchOptions = this.fetchOptions.bind(this);\n    this.fetchCharts = this.fetchCharts.bind(this);\n    this.fetchNativeAnnotations = this.fetchNativeAnnotations.bind(this);\n    this.fetchAppliedAnnotation = this.fetchAppliedAnnotation.bind(this);\n    this.fetchSliceData = this.fetchSliceData.bind(this);\n    this.shouldFetchSliceData = this.shouldFetchSliceData.bind(this);\n    this.fetchAppliedChart = this.fetchAppliedChart.bind(this);\n    this.fetchAppliedNativeAnnotation =\n      this.fetchAppliedNativeAnnotation.bind(this);\n    this.shouldFetchAppliedAnnotation =\n      this.shouldFetchAppliedAnnotation.bind(this);\n  }\n\n  componentDidMount() {\n    if (this.shouldFetchAppliedAnnotation()) {\n      const { value } = this.state;\n      /* The value prop is the id of the chart/native. This function will set\n      value in state to an object with the id as value.value to be used by\n      AsyncSelect */\n      this.fetchAppliedAnnotation(value);\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (this.shouldFetchSliceData(prevState)) {\n      const { value } = this.state;\n      this.fetchSliceData(value.value);\n    }\n  }\n\n  getSupportedSourceTypes(annotationType) {\n    // Get vis types that can be source.\n    const sources = getChartMetadataRegistry()\n      .entries()\n      .filter(({ value: chartMetadata }) =>\n        chartMetadata.canBeAnnotationType(annotationType),\n      )\n      .map(({ key, value: chartMetadata }) => ({\n        value: key,\n        label: chartMetadata.name,\n      }));\n    // Prepend native source if applicable\n    if (ANNOTATION_TYPES_METADATA[annotationType]?.supportNativeSource) {\n      sources.unshift(ANNOTATION_SOURCE_TYPES_METADATA.NATIVE);\n    }\n    return sources;\n  }\n\n  shouldFetchAppliedAnnotation() {\n    const { value, sourceType } = this.state;\n    return value && requiresQuery(sourceType);\n  }\n\n  shouldFetchSliceData(prevState) {\n    const { value, sourceType } = this.state;\n    const isChart =\n      sourceType !== ANNOTATION_SOURCE_TYPES.NATIVE &&\n      requiresQuery(sourceType);\n    const valueIsNew = value && prevState.value !== value;\n    return valueIsNew && isChart;\n  }\n\n  isValidFormulaAnnotation(expression, annotationType) {\n    if (annotationType === ANNOTATION_TYPES.FORMULA) {\n      return isValidExpression(expression);\n    }\n    return true;\n  }\n\n  isValidForm() {\n    const {\n      name,\n      annotationType,\n      sourceType,\n      value,\n      timeColumn,\n      intervalEndColumn,\n    } = this.state;\n    const errors = [\n      validateNonEmpty(name),\n      validateNonEmpty(annotationType),\n      validateNonEmpty(value),\n    ];\n    if (sourceType !== ANNOTATION_SOURCE_TYPES.NATIVE) {\n      if (annotationType === ANNOTATION_TYPES.EVENT) {\n        errors.push(validateNonEmpty(timeColumn));\n      }\n      if (annotationType === ANNOTATION_TYPES.INTERVAL) {\n        errors.push(validateNonEmpty(timeColumn));\n        errors.push(validateNonEmpty(intervalEndColumn));\n      }\n    }\n    errors.push(!this.isValidFormulaAnnotation(value, annotationType));\n    return !errors.filter(x => x).length;\n  }\n\n  handleAnnotationType(annotationType) {\n    this.setState({\n      annotationType,\n      sourceType: null,\n      value: null,\n      slice: null,\n    });\n  }\n\n  handleAnnotationSourceType(sourceType) {\n    const { sourceType: prevSourceType } = this.state;\n\n    if (prevSourceType !== sourceType) {\n      this.setState({\n        sourceType,\n        value: null,\n        slice: null,\n      });\n    }\n  }\n\n  handleSelectValue(selectedValueObject) {\n    this.setState({\n      value: selectedValueObject,\n      descriptionColumns: [],\n      intervalEndColumn: null,\n      timeColumn: null,\n      titleColumn: null,\n      overrides: { time_range: null },\n    });\n  }\n\n  handleTextValue(inputValue) {\n    this.setState({\n      value: inputValue,\n    });\n  }\n\n  fetchNativeAnnotations = async (search, page, pageSize) => {\n    const queryParams = rison.encode({\n      filters: [\n        {\n          col: 'name',\n          opr: 'ct',\n          value: search,\n        },\n      ],\n      columns: ['id', 'name'],\n      page,\n      page_size: pageSize,\n    });\n\n    const { json } = await SupersetClient.get({\n      endpoint: `/api/v1/annotation_layer/?q=${queryParams}`,\n    });\n\n    const { result, count } = json;\n\n    const layersArray = result.map(layer => ({\n      value: layer.id,\n      label: layer.name,\n    }));\n\n    return {\n      data: layersArray,\n      totalCount: count,\n    };\n  };\n\n  fetchCharts = async (search, page, pageSize) => {\n    const { annotationType } = this.state;\n\n    const queryParams = rison.encode({\n      filters: [\n        { col: 'slice_name', opr: 'chart_all_text', value: search },\n        {\n          col: 'id',\n          opr: 'chart_owned_created_favored_by_me',\n          value: true,\n        },\n      ],\n      columns: ['id', 'slice_name', 'viz_type'],\n      order_column: 'slice_name',\n      order_direction: 'asc',\n      page,\n      page_size: pageSize,\n    });\n    const { json } = await SupersetClient.get({\n      endpoint: `/api/v1/chart/?q=${queryParams}`,\n    });\n\n    const { result, count } = json;\n    const registry = getChartMetadataRegistry();\n\n    const chartsArray = result\n      .filter(chart => {\n        const metadata = registry.get(chart.viz_type);\n        return metadata && metadata.canBeAnnotationType(annotationType);\n      })\n      .map(chart => ({\n        value: chart.id,\n        label: chart.slice_name,\n        viz_type: chart.viz_type,\n      }));\n\n    return {\n      data: chartsArray,\n      totalCount: count,\n    };\n  };\n\n  fetchOptions = (search, page, pageSize) => {\n    const { sourceType } = this.state;\n\n    if (sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n      return this.fetchNativeAnnotations(search, page, pageSize);\n    }\n    return this.fetchCharts(search, page, pageSize);\n  };\n\n  fetchSliceData = id => {\n    const queryParams = rison.encode({\n      columns: ['query_context'],\n    });\n    SupersetClient.get({\n      endpoint: `/api/v1/chart/${id}?q=${queryParams}`,\n    }).then(({ json }) => {\n      const { result } = json;\n      const queryContext = result.query_context;\n      const formData = JSON.parse(queryContext).form_data;\n      const dataObject = {\n        data: {\n          ...formData,\n          groupby: formData.groupby?.map(column => getColumnLabel(column)),\n        },\n      };\n      this.setState({\n        slice: dataObject,\n      });\n    });\n  };\n\n  fetchAppliedChart(id) {\n    const { annotationType } = this.state;\n    const registry = getChartMetadataRegistry();\n    const queryParams = rison.encode({\n      columns: ['slice_name', 'query_context', 'viz_type'],\n    });\n    SupersetClient.get({\n      endpoint: `/api/v1/chart/${id}?q=${queryParams}`,\n    }).then(({ json }) => {\n      const { result } = json;\n      const sliceName = result.slice_name;\n      const queryContext = result.query_context;\n      const vizType = result.viz_type;\n      const formData = JSON.parse(queryContext).form_data;\n      const metadata = registry.get(vizType);\n      const canBeAnnotationType =\n        metadata && metadata.canBeAnnotationType(annotationType);\n      if (canBeAnnotationType) {\n        this.setState({\n          value: {\n            value: id,\n            label: sliceName,\n          },\n          slice: {\n            data: {\n              ...formData,\n              groupby: formData.groupby?.map(column => getColumnLabel(column)),\n            },\n          },\n        });\n      }\n    });\n  }\n\n  fetchAppliedNativeAnnotation(id) {\n    SupersetClient.get({\n      endpoint: `/api/v1/annotation_layer/${id}`,\n    }).then(({ json }) => {\n      const { result } = json;\n      const layer = result;\n      this.setState({\n        value: {\n          value: layer.id,\n          label: layer.name,\n        },\n      });\n    });\n  }\n\n  fetchAppliedAnnotation(id) {\n    const { sourceType } = this.state;\n\n    if (sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n      return this.fetchAppliedNativeAnnotation(id);\n    }\n    return this.fetchAppliedChart(id);\n  }\n\n  deleteAnnotation() {\n    this.props.removeAnnotationLayer();\n    this.props.close();\n  }\n\n  applyAnnotation() {\n    const { value, sourceType } = this.state;\n    if (this.isValidForm()) {\n      const annotationFields = [\n        'name',\n        'annotationType',\n        'sourceType',\n        'color',\n        'opacity',\n        'style',\n        'width',\n        'showMarkers',\n        'hideLine',\n        'overrides',\n        'show',\n        'showLabel',\n        'titleColumn',\n        'descriptionColumns',\n        'timeColumn',\n        'intervalEndColumn',\n      ];\n      const newAnnotation = {};\n      annotationFields.forEach(field => {\n        if (this.state[field] !== null) {\n          newAnnotation[field] = this.state[field];\n        }\n      });\n\n      // Prepare newAnnotation.value for use in runAnnotationQuery()\n      const applicableValue = requiresQuery(sourceType) ? value.value : value;\n      newAnnotation.value = applicableValue;\n\n      if (newAnnotation.color === AUTOMATIC_COLOR) {\n        newAnnotation.color = null;\n      }\n\n      this.props.addAnnotationLayer(newAnnotation);\n      this.setState({ isNew: false });\n    }\n  }\n\n  submitAnnotation() {\n    this.applyAnnotation();\n    this.props.close();\n  }\n\n  renderChartHeader(label, description, value) {\n    return (\n      <ControlHeader\n        hovered\n        label={label}\n        description={description}\n        validationErrors={!value ? ['Mandatory'] : []}\n      />\n    );\n  }\n\n  renderValueConfiguration() {\n    const { annotationType, sourceType, value } = this.state;\n    let label = '';\n    let description = '';\n    if (requiresQuery(sourceType)) {\n      if (sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n        label = t('Annotation layer');\n        description = t('Select the Annotation Layer you would like to use.');\n      } else {\n        label = t('Chart');\n        description = t(\n          `Use another existing chart as a source for annotations and overlays.\n          Your chart must be one of these visualization types: [%s]`,\n          this.getSupportedSourceTypes(annotationType)\n            .map(x => x.label)\n            .join(', '),\n        );\n      }\n    } else if (annotationType === ANNOTATION_TYPES.FORMULA) {\n      label = t('Formula');\n      description = t(`Expects a formula with depending time parameter 'x'\n        in milliseconds since epoch. mathjs is used to evaluate the formulas.\n        Example: '2x+5'`);\n    }\n    if (requiresQuery(sourceType)) {\n      return (\n        <AsyncSelect\n          /* key to force re-render on sourceType change */\n          key={sourceType}\n          ariaLabel={t('Annotation layer value')}\n          name=\"annotation-layer-value\"\n          header={this.renderChartHeader(label, description, value)}\n          options={this.fetchOptions}\n          value={value || null}\n          onChange={this.handleSelectValue}\n          notFoundContent={<NotFoundContent />}\n        />\n      );\n    }\n    if (annotationType === ANNOTATION_TYPES.FORMULA) {\n      return (\n        <TextControl\n          name=\"annotation-layer-value\"\n          hovered\n          showHeader\n          description={description}\n          label={label}\n          placeholder=\"\"\n          value={value}\n          onChange={this.handleTextValue}\n          validationErrors={\n            !this.isValidFormulaAnnotation(value, annotationType)\n              ? [t('Bad formula.')]\n              : []\n          }\n        />\n      );\n    }\n    return '';\n  }\n\n  renderSliceConfiguration() {\n    const {\n      annotationType,\n      sourceType,\n      value,\n      slice,\n      overrides,\n      titleColumn,\n      timeColumn,\n      intervalEndColumn,\n      descriptionColumns,\n    } = this.state;\n\n    if (!slice || !value) {\n      return '';\n    }\n\n    if (sourceType !== ANNOTATION_SOURCE_TYPES.NATIVE && slice) {\n      const columns = (slice.data.groupby || [])\n        .concat(slice.data.all_columns || [])\n        .map(x => ({ value: x, label: x }));\n      const timeColumnOptions = slice.data.include_time\n        ? [{ value: '__timestamp', label: '__timestamp' }].concat(columns)\n        : columns;\n      return (\n        <div style={{ marginRight: '2rem' }}>\n          <PopoverSection\n            isSelected\n            title={t('Annotation Slice Configuration')}\n            info={t(`This section allows you to configure how to use the slice\n              to generate annotations.`)}\n          >\n            {(annotationType === ANNOTATION_TYPES.EVENT ||\n              annotationType === ANNOTATION_TYPES.INTERVAL) && (\n              <SelectControl\n                ariaLabel={t('Annotation layer time column')}\n                hovered\n                name=\"annotation-layer-time-column\"\n                label={\n                  annotationType === ANNOTATION_TYPES.INTERVAL\n                    ? t('Interval start column')\n                    : t('Event time column')\n                }\n                description={t(\n                  'This column must contain date/time information.',\n                )}\n                validationErrors={!timeColumn ? ['Mandatory'] : []}\n                clearable={false}\n                options={timeColumnOptions}\n                value={timeColumn}\n                onChange={v => this.setState({ timeColumn: v })}\n              />\n            )}\n            {annotationType === ANNOTATION_TYPES.INTERVAL && (\n              <SelectControl\n                ariaLabel={t('Annotation layer interval end')}\n                hovered\n                name=\"annotation-layer-intervalEnd\"\n                label={t('Interval End column')}\n                description={t(\n                  'This column must contain date/time information.',\n                )}\n                validationErrors={!intervalEndColumn ? ['Mandatory'] : []}\n                options={columns}\n                value={intervalEndColumn}\n                onChange={value => this.setState({ intervalEndColumn: value })}\n              />\n            )}\n            <SelectControl\n              ariaLabel={t('Annotation layer title column')}\n              hovered\n              name=\"annotation-layer-title\"\n              label={t('Title Column')}\n              description={t('Pick a title for you annotation.')}\n              options={[{ value: '', label: t('None') }].concat(columns)}\n              value={titleColumn}\n              onChange={value => this.setState({ titleColumn: value })}\n            />\n            {annotationType !== ANNOTATION_TYPES.TIME_SERIES && (\n              <SelectControl\n                ariaLabel={t('Annotation layer description columns')}\n                hovered\n                name=\"annotation-layer-title\"\n                label={t('Description Columns')}\n                description={t(\n                  \"Pick one or more columns that should be shown in the annotation. If you don't select a column all of them will be shown.\",\n                )}\n                multi\n                options={columns}\n                value={descriptionColumns}\n                onChange={value => this.setState({ descriptionColumns: value })}\n              />\n            )}\n            <div style={{ marginTop: '1rem' }}>\n              <CheckboxControl\n                hovered\n                name=\"annotation-override-time_range\"\n                label={t('Override time range')}\n                description={t(`This controls whether the \"time_range\" field from the current\n                  view should be passed down to the chart containing the annotation data.`)}\n                value={'time_range' in overrides}\n                onChange={v => {\n                  delete overrides.time_range;\n                  if (v) {\n                    this.setState({\n                      overrides: { ...overrides, time_range: null },\n                    });\n                  } else {\n                    this.setState({ overrides: { ...overrides } });\n                  }\n                }}\n              />\n              <CheckboxControl\n                hovered\n                name=\"annotation-override-timegrain\"\n                label={t('Override time grain')}\n                description={t(`This controls whether the time grain field from the current\n                  view should be passed down to the chart containing the annotation data.`)}\n                value={'time_grain_sqla' in overrides}\n                onChange={v => {\n                  delete overrides.time_grain_sqla;\n                  delete overrides.granularity;\n                  if (v) {\n                    this.setState({\n                      overrides: {\n                        ...overrides,\n                        time_grain_sqla: null,\n                        granularity: null,\n                      },\n                    });\n                  } else {\n                    this.setState({ overrides: { ...overrides } });\n                  }\n                }}\n              />\n              <TextControl\n                hovered\n                name=\"annotation-layer-timeshift\"\n                label={t('Time Shift')}\n                description={t(`Time delta in natural language\n                  (example:  24 hours, 7 days, 56 weeks, 365 days)`)}\n                placeholder=\"\"\n                value={overrides.time_shift}\n                onChange={v =>\n                  this.setState({ overrides: { ...overrides, time_shift: v } })\n                }\n              />\n            </div>\n          </PopoverSection>\n        </div>\n      );\n    }\n    return '';\n  }\n\n  renderDisplayConfiguration() {\n    const {\n      color,\n      opacity,\n      style,\n      width,\n      showMarkers,\n      hideLine,\n      annotationType,\n    } = this.state;\n    const colorScheme = getCategoricalSchemeRegistry()\n      .get(this.props.colorScheme)\n      .colors.concat();\n    if (\n      color &&\n      color !== AUTOMATIC_COLOR &&\n      !colorScheme.find(x => x.toLowerCase() === color.toLowerCase())\n    ) {\n      colorScheme.push(color);\n    }\n    return (\n      <PopoverSection\n        isSelected\n        title={t('Display configuration')}\n        info={t('Configure your how you overlay is displayed here.')}\n      >\n        <SelectControl\n          ariaLabel={t('Annotation layer stroke')}\n          name=\"annotation-layer-stroke\"\n          label={t('Style')}\n          // see '../../../visualizations/nvd3_vis.css'\n          options={[\n            { value: 'solid', label: t('Solid') },\n            { value: 'dashed', label: t('Dashed') },\n            { value: 'longDashed', label: t('Long dashed') },\n            { value: 'dotted', label: t('Dotted') },\n          ]}\n          value={style}\n          clearable={false}\n          onChange={v => this.setState({ style: v })}\n        />\n        <SelectControl\n          ariaLabel={t('Annotation layer opacity')}\n          name=\"annotation-layer-opacity\"\n          label={t('Opacity')}\n          // see '../../../visualizations/nvd3_vis.css'\n          options={[\n            { value: '', label: t('Solid') },\n            { value: 'opacityLow', label: '0.2' },\n            { value: 'opacityMedium', label: '0.5' },\n            { value: 'opacityHigh', label: '0.8' },\n          ]}\n          value={opacity}\n          onChange={value => this.setState({ opacity: value })}\n        />\n        <div>\n          <ControlHeader label={t('Color')} />\n          <div style={{ display: 'flex', flexDirection: 'column' }}>\n            <CompactPicker\n              color={color}\n              colors={colorScheme}\n              onChangeComplete={v => this.setState({ color: v.hex })}\n            />\n            <Button\n              style={{ marginTop: '0.5rem', marginBottom: '0.5rem' }}\n              buttonStyle={color === AUTOMATIC_COLOR ? 'success' : 'default'}\n              buttonSize=\"xsmall\"\n              onClick={() => this.setState({ color: AUTOMATIC_COLOR })}\n            >\n              {t('Automatic Color')}\n            </Button>\n          </div>\n        </div>\n        <TextControl\n          name=\"annotation-layer-stroke-width\"\n          label={t('Line width')}\n          isInt\n          value={width}\n          onChange={v => this.setState({ width: v })}\n        />\n        {annotationType === ANNOTATION_TYPES.TIME_SERIES && (\n          <CheckboxControl\n            hovered\n            name=\"annotation-layer-show-markers\"\n            label={t('Show Markers')}\n            description={t('Shows or hides markers for the time series')}\n            value={showMarkers}\n            onChange={v => this.setState({ showMarkers: v })}\n          />\n        )}\n        {annotationType === ANNOTATION_TYPES.TIME_SERIES && (\n          <CheckboxControl\n            hovered\n            name=\"annotation-layer-hide-line\"\n            label={t('Hide Line')}\n            description={t('Hides the Line for the time series')}\n            value={hideLine}\n            onChange={v => this.setState({ hideLine: v })}\n          />\n        )}\n      </PopoverSection>\n    );\n  }\n\n  render() {\n    const { isNew, name, annotationType, sourceType, show, showLabel } =\n      this.state;\n    const isValid = this.isValidForm();\n    const metadata = getChartMetadataRegistry().get(this.props.vizType);\n    const supportedAnnotationTypes = metadata\n      ? metadata.supportedAnnotationTypes.map(\n          type => ANNOTATION_TYPES_METADATA[type],\n        )\n      : [];\n    const supportedSourceTypes = this.getSupportedSourceTypes(annotationType);\n\n    return (\n      <>\n        {this.props.error && (\n          <span style={{ color: this.props.theme.colors.error.base }}>\n            ERROR: {this.props.error}\n          </span>\n        )}\n        <div style={{ display: 'flex', flexDirection: 'row' }}>\n          <div style={{ marginRight: '2rem' }}>\n            <PopoverSection\n              isSelected\n              title={t('Layer configuration')}\n              info={t('Configure the basics of your Annotation Layer.')}\n            >\n              <TextControl\n                name=\"annotation-layer-name\"\n                label={t('Name')}\n                placeholder=\"\"\n                value={name}\n                onChange={v => this.setState({ name: v })}\n                validationErrors={!name ? [t('Mandatory')] : []}\n              />\n              <CheckboxControl\n                name=\"annotation-layer-hide\"\n                label={t('Hide layer')}\n                value={!show}\n                onChange={v => this.setState({ show: !v })}\n              />\n              <CheckboxControl\n                name=\"annotation-label-show\"\n                label={t('Show label')}\n                value={showLabel}\n                hovered\n                description={t('Whether to always show the annotation label')}\n                onChange={v => this.setState({ showLabel: v })}\n              />\n              <SelectControl\n                ariaLabel={t('Annotation layer type')}\n                hovered\n                description={t('Choose the annotation layer type')}\n                label={t('Annotation layer type')}\n                name=\"annotation-layer-type\"\n                clearable={false}\n                options={supportedAnnotationTypes}\n                value={annotationType}\n                onChange={this.handleAnnotationType}\n              />\n              {supportedSourceTypes.length > 0 && (\n                <SelectControl\n                  ariaLabel={t('Annotation source type')}\n                  hovered\n                  description={t('Choose the source of your annotations')}\n                  label={t('Annotation source')}\n                  name=\"annotation-source-type\"\n                  options={supportedSourceTypes}\n                  notFoundContent={<NotFoundContent />}\n                  value={sourceType}\n                  onChange={this.handleAnnotationSourceType}\n                  validationErrors={!sourceType ? [t('Mandatory')] : []}\n                />\n              )}\n              {this.renderValueConfiguration()}\n            </PopoverSection>\n          </div>\n          {this.renderSliceConfiguration()}\n          {this.renderDisplayConfiguration()}\n        </div>\n        <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n          {isNew ? (\n            <Button buttonSize=\"small\" onClick={() => this.props.close()}>\n              {t('Cancel')}\n            </Button>\n          ) : (\n            <Button buttonSize=\"small\" onClick={this.deleteAnnotation}>\n              {t('Remove')}\n            </Button>\n          )}\n          <div>\n            <Button\n              buttonSize=\"small\"\n              disabled={!isValid}\n              onClick={this.applyAnnotation}\n            >\n              {t('Apply')}\n            </Button>\n\n            <Button\n              buttonSize=\"small\"\n              buttonStyle=\"primary\"\n              disabled={!isValid}\n              onClick={this.submitAnnotation}\n            >\n              {t('OK')}\n            </Button>\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n\nAnnotationLayer.propTypes = propTypes;\nAnnotationLayer.defaultProps = defaultProps;\n\nexport default withTheme(AnnotationLayer);\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport mexp from 'math-expression-evaluator';\n\nconst REPLACE_OPERATORS: [RegExp, string][] = [\n  [new RegExp(/==/g), 'Eq'],\n  [new RegExp(/>=/g), 'Gte'],\n  [new RegExp(/<=/g), 'Lte'],\n  [new RegExp(/>/g), 'Gt'],\n  [new RegExp(/</g), 'Lt'],\n];\n\nconst TOKENS = [\n  {\n    type: 3,\n    token: 'x',\n    show: 'x',\n    value: 'x',\n  },\n  {\n    type: 2,\n    token: '&',\n    show: '&',\n    value: (a: number, b: number): number => a & b,\n  },\n  {\n    type: 2,\n    token: '|',\n    show: '|',\n    value: (a: number, b: number): number => a | b,\n  },\n  {\n    type: 2,\n    token: 'and',\n    show: 'and',\n    value: (a: number, b: number): number => a && b,\n  },\n  {\n    type: 2,\n    token: 'xor',\n    show: 'xor',\n    value: (a: number, b: number): number => a ^ b,\n  },\n  {\n    type: 2,\n    token: 'or',\n    show: 'or',\n    value: (a: number, b: number): number => Number(a || b),\n  },\n  {\n    type: 2,\n    token: 'Eq',\n    show: 'Eq',\n    value: (a: number, b: number): number => Number(a === b),\n  },\n  {\n    type: 2,\n    token: 'Lt',\n    show: 'Lt',\n    value: (a: number, b: number): number => Number(a < b),\n  },\n  {\n    type: 2,\n    token: 'Lte',\n    show: 'Lte',\n    value: (a: number, b: number): number => Number(a <= b),\n  },\n  {\n    type: 2,\n    token: 'Gt',\n    show: 'Gt',\n    value: (a: number, b: number): number => Number(a > b),\n  },\n  {\n    type: 2,\n    token: 'Gte',\n    show: 'Gte',\n    value: (a: number, b: number): number => Number(a >= b),\n  },\n];\n\nexport function evalExpression(expression: string, value: number): number {\n  let parsedExpression = expression;\n  // replace `<` with `Lt` (and others) to avoid clashes with builtin function operators\n  // that are not needed in Superset.\n  REPLACE_OPERATORS.forEach(([key, value]) => {\n    parsedExpression = parsedExpression.replace(key, value);\n  });\n  const subExpressions = String(parsedExpression).split('=');\n  parsedExpression = subExpressions[1] ?? subExpressions[0];\n  // we can ignore the type requirement on `TOKENS`, as value is always `number`\n  // and doesn't need to consider `number | undefined`.\n  // @ts-ignore\n  return Number(mexp.eval(parsedExpression, TOKENS, { x: value }));\n}\n\nexport function isValidExpression(expression: string): boolean {\n  try {\n    evalExpression(expression, 0);\n  } catch (err) {\n    return false;\n  }\n  return true;\n}\n"],"names":["extractTypes","metadata","Object","keys","reduce","prev","key","result","ANNOTATION_TYPES_METADATA","FORMULA","value","label","t","EVENT","supportNativeSource","INTERVAL","TIME_SERIES","ANNOTATION_TYPES","DEFAULT_ANNOTATION_TYPE","ANNOTATION_SOURCE_TYPES_METADATA","NATIVE","ANNOTATION_SOURCE_TYPES","requiresQuery","annotationSourceType","AUTOMATIC_COLOR","propTypes","name","PropTypes","annotationType","sourceType","color","opacity","style","width","showMarkers","hideLine","overrides","show","showLabel","titleColumn","descriptionColumns","timeColumn","intervalEndColumn","vizType","error","colorScheme","addAnnotationLayer","removeAnnotationLayer","close","defaultProps","NotFoundContentWrapper","styled","div","NotFoundContent","___EmotionJSX","EmptyStateSmall","title","description","href","target","rel","image","AnnotationLayer","React","constructor","props","super","fetchNativeAnnotations","async","search","page","pageSize","queryParams","rison","filters","col","opr","columns","page_size","json","SupersetClient","get","endpoint","count","data","map","layer","id","totalCount","fetchCharts","this","state","order_column","order_direction","registry","getChartMetadataRegistry","filter","chart","viz_type","canBeAnnotationType","slice_name","fetchOptions","fetchSliceData","then","_ref","_formData$groupby","queryContext","query_context","formData","JSON","parse","form_data","dataObject","groupby","column","getColumnLabel","setState","slice","time_range","since","until","supportedAnnotationTypes","validAnnotationType","includes","isNew","submitAnnotation","bind","deleteAnnotation","applyAnnotation","isValidForm","handleAnnotationType","handleAnnotationSourceType","handleSelectValue","handleTextValue","fetchAppliedAnnotation","shouldFetchSliceData","fetchAppliedChart","fetchAppliedNativeAnnotation","shouldFetchAppliedAnnotation","componentDidMount","componentDidUpdate","prevProps","prevState","getSupportedSourceTypes","_ANNOTATION_TYPES_MET","sources","entries","_ref2","chartMetadata","_ref3","unshift","isChart","isValidFormulaAnnotation","expression","isValidExpression","errors","validateNonEmpty","push","x","length","prevSourceType","selectedValueObject","inputValue","_ref4","sliceName","_formData$groupby2","_ref5","newAnnotation","forEach","field","applicableValue","renderChartHeader","ControlHeader","hovered","validationErrors","renderValueConfiguration","join","AsyncSelect","ariaLabel","header","options","onChange","notFoundContent","TextControl","showHeader","placeholder","renderSliceConfiguration","concat","all_columns","timeColumnOptions","include_time","marginRight","PopoverSection","isSelected","info","SelectControl","clearable","v","multi","marginTop","CheckboxControl","time_grain_sqla","granularity","time_shift","renderDisplayConfiguration","getCategoricalSchemeRegistry","colors","find","toLowerCase","display","flexDirection","CompactPicker","onChangeComplete","hex","Button","marginBottom","buttonStyle","buttonSize","onClick","isInt","render","isValid","type","supportedSourceTypes","theme","base","justifyContent","disabled","withTheme","REPLACE_OPERATORS","RegExp","TOKENS","token","a","b","Number","evalExpression","_subExpressions$","parsedExpression","replace","subExpressions","String","split","mexp","err"],"sourceRoot":""}